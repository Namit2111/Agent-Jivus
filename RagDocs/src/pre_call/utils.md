# prompt_utils.py Documentation

This module provides utility functions for generating prompts for various call scenarios, leveraging LinkedIn profile data and website scraping. It integrates with OpenAI's API and external services like Nubela and Prospeo for data retrieval.

## Imports

- `json`: For JSON handling.
- `fastapi`: For building the API.
- `HTTPException`, `status`: For handling HTTP errors in the API.
- `OAuth2PasswordBearer`: For authentication.
- `openai`: For interacting with the OpenAI API.
- `requests`: For making HTTP requests.
- `os.path`: For path manipulation.
- `src.db.schemas`: For database schemas (User).
- `src.db.utils`: For user authentication (`authenticate_user`).
- `src.logger`: For logging.
- `src.config`: For application configuration.
- `src.enums`: For enums (CallTypes, ProfileTypes).
- `src.utils.prompts`: For retrieving prompts.
- `src.utils.website_scraper`: For scraping websites.
- `src.utils.prompt_formatter`: For prompt formatting (PromptTemplate).
- `src.db.subroutes.personas`: For accessing persona data (`get_persona`).
- `src.db.models`: For database models (LinkedInInfos, ModelInfos, ProductInfos, ProfileInfos).


## Global Variables

- `logger`: An instance of the Logger class for logging messages.
- `openai.api_key`: Sets the OpenAI API key from the configuration.


## Functions

### `get_linkedin_profile_nubela(linkedin_url)`

Retrieves LinkedIn profile data using the Nubela API or a sample JSON file if `USE_NUBELA` is false in the config.

**Parameters:**

- `linkedin_url (str)`: The URL of the LinkedIn profile.

**Returns:**

- `dict`: The LinkedIn profile data as a dictionary.

**Raises:**

- `Exception`: If there's an error in retrieving the profile from Nubela.


### `linkedin_summary_generation(url: str)`

Generates a LinkedIn profile summary using OpenAI's API.

**Parameters:**

- `url (str)`: The LinkedIn profile URL.

**Returns:**

- `tuple`: A tuple containing the raw LinkedIn API response, personality summary, and buying style from the LLM.


### `website_summary_generation(url: str = "")`

Generates a website summary using OpenAI's API.  Currently has redundant code (TODO: remove unused url parameter).

**Parameters:**

- `url (str)`: The website URL (currently unused).

**Returns:**

- `tuple`: A tuple containing the raw website data and the product description generated by the LLM.


### `get_persona_profile_info(persona)`

Retrieves or updates persona profile information, including LinkedIn data, from the database.

**Parameters:**

- `persona`: A Persona object.

**Returns:**

- `tuple`: A tuple containing the raw LinkedIn API response, LinkedIn summary, and buying style.


### `training_call_prompt_generation(persona_id, user_info: User)`

Generates a prompt for a training call based on persona and user information.

**Parameters:**

- `persona_id`: The ID of the persona.
- `user_info (User)`: The user's information.

**Returns:**

- `str`: The generated training call prompt.


### `get_training_call_prompt(conversation_id: str)`

Retrieves a training call prompt from the database.

**Parameters:**

- `conversation_id (str)`: The ID of the conversation.

**Returns:**

- `str`: The training call prompt.


### `get_linkedin_profile_prospeo(linkedin_url)`

Retrieves LinkedIn profile data using the Prospeo API.

**Parameters:**

- `linkedin_url (str)`: The URL of the LinkedIn profile.

**Returns:**

- `dict`: The LinkedIn profile data as a dictionary.


### `oauth2_scheme`

An OAuth2PasswordBearer instance for authentication.


### `get_auth_response(auth_token: str = Depends(oauth2_scheme)) -> dict`

Authenticates the user based on the provided token.

**Parameters:**

- `auth_token (str)`: The authentication token.

**Returns:**

- `dict`: The authentication response.

**Raises:**

- `HTTPException`: If authentication fails.

## Configuration

The module relies heavily on configuration parameters stored in `src.config`, including API keys for OpenAI, Nubela, and Prospeo, as well as paths to various files (prompts, schemas).  These parameters control the behavior of the functions, including which APIs to use and how prompts are generated.
